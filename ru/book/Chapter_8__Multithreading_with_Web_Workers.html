<!DOCTYPE html>
<html lang="ru" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Многопоточность с Web Workers | Vue FAQ</title>
    <meta name="description" content="Учебник по Vue.js 3">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.NZRJ94Cd.css" as="style">
    
    <script type="module" src="/assets/app.BuTueZx4.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.C02k9F-l.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B8KxSsRZ.js">
    <link rel="modulepreload" href="/assets/ru_book_Chapter_8__Multithreading_with_Web_Workers.md.DsOwuZtC.lean.js">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Vue FAQ">
    <meta property="og:image" content="/images/vue-faq-logo.png">
    <meta property="twitter:card" content="summary">
    <meta property="twitter:description" content="Vue FAQ - information about Vue.js and frontend development in general">
    <meta property="twitter:site" content="@vuefaq">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JL65GWRNZZ"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JL65GWRNZZ");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta property="og:description" content="Vue FAQ - информация о фреймворке Vue.js и фронтенд разработке в целом">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JL65GWRNZZ"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JL65GWRNZZ");</script>
    <meta name="og:site_name" content="Vue.js 3 - Шаблоны проектирования и лучшие практики">
    <meta name="og:image" content="/images/book-face.jpg">
    <meta name="twitter:image" content="/images/book-face.jpg">
  </head>
  <body>
    <div id="app"><div class="Layout textbook" data-v-f34fde7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-97ec2f41></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-97ec2f41> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f34fde7e data-v-1186b740><div class="VPNavBar has-sidebar top" data-v-1186b740 data-v-743a22c8><div class="wrapper" data-v-743a22c8><div class="container" data-v-743a22c8><div class="title" data-v-743a22c8><div class="VPNavBarTitle has-sidebar" data-v-743a22c8 data-v-663a90b9><a class="title" href="/ru/" data-v-663a90b9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/images/vue-faq-logo.webp" alt data-v-b2acdd16><!--]--><span data-v-663a90b9>Vue FAQ</span><!--[--><!--]--></a></div></div><div class="content" data-v-743a22c8><div class="content-body" data-v-743a22c8><!--[--><!--]--><div class="VPNavBarSearch search" data-v-743a22c8><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-743a22c8 data-v-cc0a843c><span id="main-nav-aria-label" class="visually-hidden" data-v-cc0a843c>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/misc/introduction.html" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>FAQ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/book/" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>Учебник</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/vue-webapp/" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>vue-webapp</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/release-timeline/" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>Release Timeline</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/arty-crafty/" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>Arty-Crafty</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ru/articles/" tabindex="0" data-v-cc0a843c data-v-4feaec24><!--[--><span data-v-4feaec24>Статьи</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-cc0a843c data-v-0fe5f390><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-0fe5f390><span class="text" data-v-0fe5f390><!----><span data-v-0fe5f390>v 1.4</span><span class="vpi-chevron-down text-icon" data-v-0fe5f390></span></span></button><div class="menu" data-v-0fe5f390><div class="VPMenu" data-v-0fe5f390 data-v-5251f9c9><div class="items" data-v-5251f9c9><!--[--><!--[--><div class="VPMenuLink" data-v-5251f9c9 data-v-fb6e9438><a class="VPLink link" href="/ru/misc/CHANGELOG.html" data-v-fb6e9438><!--[-->Changelog<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5251f9c9 data-v-fb6e9438><a class="VPLink link" href="/ru/misc/contribute.html" data-v-fb6e9438><!--[-->Внести вклад<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5251f9c9 data-v-fb6e9438><a class="VPLink link vp-external-link-icon" href="https://t.me/vuejs_ru" target="_blank" rel="noreferrer" data-v-fb6e9438><!--[-->@vuejs_ru<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5251f9c9 data-v-fb6e9438><a class="VPLink link vp-external-link-icon" href="https://www.reddit.com/r/vuejs/" target="_blank" rel="noreferrer" data-v-fb6e9438><!--[-->@/r/vuejs/<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-743a22c8 data-v-016258cd data-v-0fe5f390><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-0fe5f390><span class="text" data-v-0fe5f390><span class="vpi-languages option-icon" data-v-0fe5f390></span><!----><span class="vpi-chevron-down text-icon" data-v-0fe5f390></span></span></button><div class="menu" data-v-0fe5f390><div class="VPMenu" data-v-0fe5f390 data-v-5251f9c9><!----><!--[--><!--[--><div class="items" data-v-016258cd><p class="title" data-v-016258cd>Русский</p><!--[--><div class="VPMenuLink" data-v-016258cd data-v-fb6e9438><a class="VPLink link" href="/en/book/Chapter_8__Multithreading_with_Web_Workers.html" data-v-fb6e9438><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-743a22c8 data-v-0e630b14><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-0e630b14 data-v-e51d7bc4 data-v-79f406f6><span class="check" data-v-79f406f6><span class="icon" data-v-79f406f6><!--[--><span class="vpi-sun sun" data-v-e51d7bc4></span><span class="vpi-moon moon" data-v-e51d7bc4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-743a22c8 data-v-723a27a4 data-v-cb91b013><!--[--><a class="VPSocialLink no-icon" href="https://t.me/vuefaq" aria-label target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><svg id="Livello_1" data-name="Livello 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 240 240"><circle cx="120" cy="120" r="120" fill="#1d93d2"></circle><path d="M81.229,128.772l14.237,39.406s1.78,3.687,3.686,3.687,30.255-29.492,30.255-29.492l31.525-60.89L81.737,118.6Z" fill="#c8daea"></path><path d="M100.106,138.878l-2.733,29.046s-1.144,8.9,7.754,0,17.415-15.763,17.415-15.763" fill="#a9c6d8"></path><path d="M81.486,130.178,52.2,120.636s-3.5-1.42-2.373-4.64c.232-.664.7-1.229,2.1-2.2,6.489-4.523,120.106-45.36,120.106-45.36s3.208-1.081,5.1-.362a2.766,2.766,0,0,1,1.885,2.055,9.357,9.357,0,0,1,.254,2.585c-.009.752-.1,1.449-.169,2.542-.692,11.165-21.4,94.493-21.4,94.493s-1.239,4.876-5.678,5.043A8.13,8.13,0,0,1,146.1,172.5c-8.711-7.493-38.819-27.727-45.472-32.177a1.27,1.27,0,0,1-.546-.9c-.093-.469.417-1.05.417-1.05s52.426-46.6,53.821-51.492c.108-.379-.3-.566-.848-.4-3.482,1.281-63.844,39.4-70.506,43.607A3.21,3.21,0,0,1,81.486,130.178Z" fill="#fff"></path></svg></a><a class="VPSocialLink no-icon" href="https://github.com/vuesence/vue-faq" aria-label="github" target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://github.com/vuesence/vue-faq" aria-label target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><svg xmlns="http://www.w3.org/2000/svg"><g><text font-weight="bold" xml:space="preserve" font-size="18" id="svg_1" y="16" x="8" fill="currentColor">Star it!</text></g></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-743a22c8 data-v-1cde8183 data-v-0fe5f390><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-0fe5f390><span class="vpi-more-horizontal icon" data-v-0fe5f390></span></button><div class="menu" data-v-0fe5f390><div class="VPMenu" data-v-0fe5f390 data-v-5251f9c9><!----><!--[--><!--[--><div class="group translations" data-v-1cde8183><p class="trans-title" data-v-1cde8183>Русский</p><!--[--><div class="VPMenuLink" data-v-1cde8183 data-v-fb6e9438><a class="VPLink link" href="/en/book/Chapter_8__Multithreading_with_Web_Workers.html" data-v-fb6e9438><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-1cde8183><div class="item appearance" data-v-1cde8183><p class="label" data-v-1cde8183>Appearance</p><div class="appearance-action" data-v-1cde8183><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-1cde8183 data-v-e51d7bc4 data-v-79f406f6><span class="check" data-v-79f406f6><span class="icon" data-v-79f406f6><!--[--><span class="vpi-sun sun" data-v-e51d7bc4></span><span class="vpi-moon moon" data-v-e51d7bc4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-1cde8183><div class="item social-links" data-v-1cde8183><div class="VPSocialLinks social-links-list" data-v-1cde8183 data-v-cb91b013><!--[--><a class="VPSocialLink no-icon" href="https://t.me/vuefaq" aria-label target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><svg id="Livello_1" data-name="Livello 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 240 240"><circle cx="120" cy="120" r="120" fill="#1d93d2"></circle><path d="M81.229,128.772l14.237,39.406s1.78,3.687,3.686,3.687,30.255-29.492,30.255-29.492l31.525-60.89L81.737,118.6Z" fill="#c8daea"></path><path d="M100.106,138.878l-2.733,29.046s-1.144,8.9,7.754,0,17.415-15.763,17.415-15.763" fill="#a9c6d8"></path><path d="M81.486,130.178,52.2,120.636s-3.5-1.42-2.373-4.64c.232-.664.7-1.229,2.1-2.2,6.489-4.523,120.106-45.36,120.106-45.36s3.208-1.081,5.1-.362a2.766,2.766,0,0,1,1.885,2.055,9.357,9.357,0,0,1,.254,2.585c-.009.752-.1,1.449-.169,2.542-.692,11.165-21.4,94.493-21.4,94.493s-1.239,4.876-5.678,5.043A8.13,8.13,0,0,1,146.1,172.5c-8.711-7.493-38.819-27.727-45.472-32.177a1.27,1.27,0,0,1-.546-.9c-.093-.469.417-1.05.417-1.05s52.426-46.6,53.821-51.492c.108-.379-.3-.566-.848-.4-3.482,1.281-63.844,39.4-70.506,43.607A3.21,3.21,0,0,1,81.486,130.178Z" fill="#fff"></path></svg></a><a class="VPSocialLink no-icon" href="https://github.com/vuesence/vue-faq" aria-label="github" target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://github.com/vuesence/vue-faq" aria-label target="_blank" rel="noopener" data-v-cb91b013 data-v-9146a764><svg xmlns="http://www.w3.org/2000/svg"><g><text font-weight="bold" xml:space="preserve" font-size="18" id="svg_1" y="16" x="8" fill="currentColor">Star it!</text></g></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-743a22c8 data-v-f393de22><span class="container" data-v-f393de22><span class="top" data-v-f393de22></span><span class="middle" data-v-f393de22></span><span class="bottom" data-v-f393de22></span></span></button></div></div></div></div><div class="divider" data-v-743a22c8><div class="divider-line" data-v-743a22c8></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-f34fde7e data-v-cd52d3f7><div class="container" data-v-cd52d3f7><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-cd52d3f7><span class="vpi-align-left menu-icon" data-v-cd52d3f7></span><span class="menu-text" data-v-cd52d3f7>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-cd52d3f7 data-v-1ec6ac20><button data-v-1ec6ac20>Наверх</button><!----></div></div></div><aside class="VPSidebar" data-v-f34fde7e data-v-dfb98cb2><div class="curtain" data-v-dfb98cb2></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-dfb98cb2><span class="visually-hidden" id="sidebar-aria-label" data-v-dfb98cb2> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-dfb98cb2><section class="VPSidebarItem level-0 has-active" data-v-dfb98cb2 data-v-28370b85><!----><div class="items" data-v-28370b85><!--[--><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Предисловие</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/summary.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Краткое содержание</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_1__The_Vue_3_Framework.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 1: Фреймворк Vue 3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_2__Software_Design_Principles_and_Patterns.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 2: Принципы и шаблоны проектирования программного обеспечения</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_3__Setting_Up_a_Working_Project.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 3: Установка рабочего проекта</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_4__User_Interface_Composition_with_Components.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 4: Композиция пользовательского интерфейса с помощью компонентов</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_5__Single-Page_Applications.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 5: Одностраничные приложения (SPA)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_6__Progressive_Web_Applications.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 6: Прогрессивные веб-приложения</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_7__Data_Flow_Management.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 7: Управление потоком данных</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_8__Multithreading_with_Web_Workers.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 8: Многопоточность с Web Workers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_9__Testing_and_Source_Control.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 9: Тестирование и системы контроля версий</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_10__Deploying_Your_Application.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 10: Развертывание приложения</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Chapter_11__Bonus_Chapter_-_UX_Patterns.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Глава 11: Бонусная глава - Шаблоны UX</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-28370b85 data-v-28370b85><div class="item" data-v-28370b85><div class="indicator" data-v-28370b85></div><a class="VPLink link link" href="/ru/book/Appendix__Migrating_from_Vue_2.html" data-v-28370b85><!--[--><p class="text" data-v-28370b85>Приложение: Миграция с Vue 2 на Vue 3</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f34fde7e data-v-69cb45dd><div class="VPDoc has-sidebar has-aside" data-v-69cb45dd data-v-bd65f111><!--[--><!--]--><div class="container" data-v-bd65f111><div class="aside" data-v-bd65f111><div class="aside-curtain" data-v-bd65f111></div><div class="aside-container" data-v-bd65f111><div class="aside-content" data-v-bd65f111><div class="VPDocAside" data-v-bd65f111 data-v-8a1c0c90><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-8a1c0c90 data-v-82f7ebc9><div class="content" data-v-82f7ebc9><div class="outline-marker" data-v-82f7ebc9></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-82f7ebc9>Содержание</div><ul class="VPDocOutlineItem root" data-v-82f7ebc9 data-v-20b2d660><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-8a1c0c90></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-bd65f111><div class="content-container" data-v-bd65f111><!--[--><!--]--><main class="main" data-v-bd65f111><div style="position:relative;" class="vp-doc _ru_book_Chapter_8__Multithreading_with_Web_Workers" data-v-bd65f111><div><h1 id="многопоточность-с-web-workers" tabindex="-1">Многопоточность с Web Workers <a class="header-anchor" href="#многопоточность-с-web-workers" aria-label="Permalink to &quot;Многопоточность с Web Workers&quot;">​</a></h1><p>В этой главе мы рассмотрим важные темы, которые позволят значительно повысить производительность веб-приложений, особенно одностраничных. Во-первых, мы узнаем, как работают веб-сайты и JavaScript, а также как использовать <strong>web workers</strong> для повышения эффективности вычислительной мощности приложения, доступа к данным и сетевых коммуникаций. Затем мы представим два новых концептуальных шаблона проектирования и реализуем их в примере приложения вместе с другими шаблонами, с которыми мы уже познакомились ранее.</p><p>Кроме того, мы представим две библиотеки, которые облегчат нам сетевые коммуникации, а также работу с постоянной базой данных (базами данных) в IndexedDB. Мы также реализуем простой сервер Node.js для обеспечения обратной связи и тестирования нашей работы в архитектуре с высокой степенью разобщенности, где наши фронтенд- и бэкенд-сервисы взаимодействуют с помощью стандартных API по протоколу HTTP.</p><p>В этой главе мы рассмотрим следующие темы:</p><ul><li>Web workers</li><li>Шаблон проектирования Business delegate</li><li>Сетевое взаимодействие внутри <strong>Web Worker</strong></li><li>Встроенная база данных браузера - IndexedDB</li><li>Как построить простой Node.js API-сервер для тестирования</li></ul><p>Концепции, изложенные в этой главе, можно считать &quot;продвинутыми&quot;, но мы сведем их к понятным фрагментам, которые можно будет сразу же реализовать. К концу этой главы вы будете иметь твердые знания о том, как реализовать многопоточность в своих веб-приложениях, а также эталонный фреймворк для масштабирования и облегчения использования сложных браузерных API.</p><h2 id="технические-требования" tabindex="-1">Технические требования <a class="header-anchor" href="#технические-требования" aria-label="Permalink to &quot;Технические требования&quot;">​</a></h2><p>Эта глава не добавляет дополнительных требований к нашему приложению. Однако мы увидим только соответствующие части кода, поэтому, чтобы увидеть работу всего приложения, следует обратиться к примерам кода для главы 8, <em>Многопоточность с Web Workers</em>, в GitHub-репозитории книги <a href="https://github.com/PacktPublishing/Vue.js-3-Design-Patterns-and-Best-Practices/tree/main/Chapter08" target="_blank" rel="noreferrer">https://github.com/PacktPublishing/Vue.js-3-Design-Patterns-and-Best-Practices/tree/main/Chapter08</a>.</p><p>Посмотрите следующее <a href="https://packt.link/D4EHt" target="_blank" rel="noreferrer">видео</a>, чтобы увидеть код в действии.</p><h2 id="введение-в-web-workers" tabindex="-1">Введение в Web workers <a class="header-anchor" href="#введение-в-web-workers" aria-label="Permalink to &quot;Введение в Web workers&quot;">​</a></h2><p>JavaScript является однопоточным языком, то есть в нем нет возможности порождать процессы в отдельных потоках. Это заставляет браузеры запускать JavaScript на веб-странице в одном потоке с другими процессами, что напрямую влияет на производительность страницы, в первую очередь на процесс рендеринга, отвечающий за отображение страницы на экране.</p><p>Браузер прилагает значительные усилия для оптимизации работы всех этих движущихся частей, чтобы сделать страницу отзывчивой, производительной, быстрой и эффективной. Однако есть задачи, которые веб-приложение должно выполнять на JavaScript, которые являются тяжелыми и потенциально &quot;блокирующими рендеринг&quot;.</p><p>Это означает, что браузеру придется обратить внимание на результаты работы кода и использовать все ресурсы для завершения выполняемой функции, прежде чем он сможет сосредоточиться на рендеринге (отображении страницы на экране). Если вы обнаружили на веб-странице процесс, из-за которого сайт кажется &quot;неотзывчивым&quot; или &quot;тормозящим&quot; после начала выполнения какого-либо действия (в некоторых случаях мышь может даже застыть), это может быть одной из причин.</p><p>Если открыть инструменты разработчика в современном браузере, то можно получить доступ к некоторым инструментам производительности для анализа поведения веб-страницы и времени, которое занимает каждый шаг процесса.</p><p>Например, вот быстрый вид первой загрузки YouTube по общей ссылке в Firefox для Linux:</p><p><img src="/assets/Figure_8.01_B18602.BlVR3Bf6.jpg" alt="image"></p><p>Рисунок 8.1 - Производительность первой загрузки YouTube при использовании инструментов разработчика</p><p>На предыдущем скриншоте мы увеличили масштаб обработки страницы, показав, что происходит до первого рендеринга, то есть до того, как пользователь увидит что-то на экране. Это представлено в первой строке <strong>Скриншоты</strong>, где для данного случая первые видимые элементы появляются в конце временной шкалы (<em>#1</em>).</p><p>Вторая строка показывает, чем занят основной <strong>Parent Process</strong>, и если вы обратите внимание, то самая первая секция (<em>#2</em>) посвящена обработке JavaScript. Процесс <strong>Renderer</strong> , выделенный и отображаемый черной полосой (#3), не может начаться до тех пор, пока не будет запущен JavaScript.</p><p>Когда он запускается, он рисует страницу на экране, и вы получаете видимое содержимое из <em>#1</em>. Это дает примерное представление о том, какую работу выполняет браузер в каждом цикле между рисованиями на экране (так называемыми &quot;кадрами&quot;). Браузер старается делать как можно больше <strong>кадров в секунду</strong> (<strong>fps</strong>). Чтобы поддерживать 60 кадров в секунду, он должен выполнять всю эту обработку примерно за 16,67 миллисекунды или меньше.</p><p>В лучшем случае процесс JavaScript должен быть решен за половину этого времени, чтобы сохранить плавность восприятия для пользователя. Что же происходит, когда обработка JavaScript занимает больше времени? Все просто: процесс рендеринга откладывается, fps падает и может возникнуть застывший <strong>пользовательский интерфейс</strong> (<strong>UI</strong>). В зависимости от особенностей вашего веб-приложения это может стать серьезной проблемой.</p><p>Вы можете сказать: &quot;Минуточку, а почему бы нам не сделать тяжелые задачи асинхронными? Разве это не решит проблему?&quot;. Ответ: и может, и нет. Когда вы объявляете асинхронную функцию, это означает лишь то, что ее выполнение будет отложено до того момента, когда обработка последовательного кода будет завершена.</p><p>Скорее всего, это сдвигает асинхронный код к концу или после выполнения последовательного кода, но затем он будет выполняться последовательно, как обычно. Если процесс рендеринга происходит раньше, то вы можете ощутить прирост производительности, но если нет, то вы столкнетесь с той же проблемой, если асинхронная функция будет выполняться дольше (так как это повлияет на следующий рендеринг).</p><p><img src="/assets/Figure_8.02_B18602.d_j1VD_M.jpg" alt="image"></p><p>Рисунок 8.2 - Представление выполнения асинхронного кода, перенесенного после выполнения последовательного кода (1)</p><p>Тогда, если асинхронные операции не решат проблему производительности полностью, как ее решить? Помимо всех возможных оптимизаций, есть одна технология, которую также следует рассматривать в начале списка альтернатив: Web workers API.</p><p>Web workers - это JavaScript-скрипты, выполняющиеся в собственном процессе (или потоке, в зависимости от реализации), что позволяет не нарушать родительский процесс, в котором происходит рендеринг.</p><p>API браузера предоставляет довольно простой, но эффективный способ связи с родительским процессом и обратно: систему сообщений. Эти сообщения могут передавать только сериализуемые данные. Родительский процесс и каждый web worker работают в своем окружении и в своих границах памяти, поэтому они не могут совместно использовать ссылки или функции, поэтому все данные, передаваемые между ними, должны быть сериализуемыми, поскольку они копируются в каждый процесс.</p><p>Хотя это может показаться недостатком, на самом деле при правильном использовании это преимущество, в чем мы вскоре убедимся. Еще одним недостатком этой архитектуры является то, что web workers не имеют доступа к <strong>документной объектной модели</strong> (<strong>DOM</strong>) или объектам Window и, соответственно, к любым их сервисам. Однако они имеют доступ к сети и IndexedDB.</p><p><img src="/assets/Figure_8.03_B18602.DCvsoXZc.jpg" alt="image"></p><p>Рисунок 8.3 - Послойное представление приложения Vue с фоновыми процессами, использующими web workers.</p><p>Как видно из предыдущей диаграммы, мы можем инстанцировать несколько web workers для представления различных типов слоев в нашем приложении (<strong>Бизнес</strong>, <strong>Данные</strong>, <strong>Коммуникация</strong> и т.д.). Хотя web worker может запускаться и завершаться из родительского процесса по своему усмотрению, оба эти действия требуют больших вычислительных затрат, поэтому рекомендуется, чтобы созданные web workers оставались активными в течение всего времени работы приложения и обращались к ним по мере необходимости.</p><p>Также не рекомендуется злоупотреблять этим ресурсом, создавая &quot;слишком много&quot; web workers, поскольку каждый из них является отдельным процессом со своими собственными ресурсами. Четкого определения того, что такое &quot;слишком много&quot;, не существует, поэтому рекомендуется проявлять осторожность. По моему опыту, если количество web workers не превышает однозначных значений, то даже на маломощных устройствах ваше приложение будет работать с отличной производительностью. Как и во многих других вещах, хорошего может быть слишком много, и это относится и к web workers.</p><p>Теперь, когда мы знаем, что такое web workers и чем они могут быть полезны, давайте посмотрим, как реализовать их на чистом JavaScript, а затем как сделать это с помощью Vite.</p><h3 id="реализация-web-worker" tabindex="-1">Реализация web worker <a class="header-anchor" href="#реализация-web-worker" aria-label="Permalink to &quot;Реализация web worker&quot;">​</a></h3><p>Создание web worker на чистом JavaScript довольно простое и понятное. Объект <strong>window</strong> предоставляет конструктор, правильно названный <strong>Worker</strong>, который получает в качестве параметра путь к файлу сценария. Например, если учесть, что наш web worker содержится в файле <strong>my_worker.js</strong>, то создать его можно следующим образом:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (window.Worker) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> my_worker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Достаточно просто, если конструктор существует в объекте <strong>window</strong>, то мы просто создаем нового web worker, обращающегося к конструктору напрямую. Вновь созданный web worker предоставляет простой API:</p><ul><li><strong>.postMessage(message)</strong>: Отправить сообщение на web worker. Это может быть любой тип данных, который может быть сериализован (основные типы данных, массивы, объекты и т.д.).</li><li><strong>.onmessage(callback(event))</strong>: Это событие срабатывает, когда web worker получает сообщение от родительского процесса. Полученное событие имеет поле <strong>.data</strong>, которое содержит сообщение/данные, переданные web worker.</li><li><strong>.onerror(callback(event))</strong>: При возникновении ошибки в web worker, срабатывает это событие, которое будет содержать следующие поля: <ul><li><strong>.filename</strong>: Имя файла скрипта, сгенерировавшего ошибку.</li><li><strong>.lineno</strong>: Номер строки, на которой произошла ошибка.</li><li><strong>.message</strong>: Строка, содержащая описание ошибки.</li></ul></li></ul><p>Эта система обмена сообщениями позволяет нам осуществлять то, что в противном случае могло бы быть очень сложной формой <strong>межпроцессного взаимодействия</strong> (<strong>IPC</strong>). После ее внедрения наш предыдущий код должен выглядеть следующим образом:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> my_worker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // обрабатываем сообщение здесь</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     //обрабатываем ошибку здесь</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Привет от родительского процесса&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Для завершения этой работы нам необходимо реализовать скрипт <strong>my_worker.js</strong>. Для данного примера он может быть таким простым:</p><h5 id="my-worker-js" tabindex="-1">./my_worker.js <a class="header-anchor" href="#my-worker-js" aria-label="Permalink to &quot;./my_worker.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmesssage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Привет от web worker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Наш пример web worker очень прост. Он печатает полученные данные в консоль, а через 3 секунды после активации отправляет сообщение родительскому процессу.</p><p>Обратите внимание, что мы используем зарезервированное слово <strong>self</strong>. Оно необходимо при обращении к API изнутри функции, так как ссылается на сам web worker. Именно поэтому оно необходимо внутри обратного вызова <strong>setTimeout</strong>. На корневом уровне он необязателен, поэтому можно написать <strong>self.onmessage</strong>, как в нашем примере, или непосредственно <strong>onmessage</strong>.</p><p>Web workers могут инстанцировать других web workers, а также импортировать другие скрипты с помощью метода <strong>self.importScript()</strong> или просто <strong>importScript()</strong>. Этот метод получает в качестве параметра строку с именем файла скрипта. Это аналогично тому, как мы используем оператор <strong>import</strong> в наших сервисах и компонентах в основном приложении.</p><p>При использовании Vite, как мы это делаем для создания нашего Vue-приложения, у нас есть альтернативный способ импорта и создания web worker с помощью суффикса. Например, добавьте следующее в наш скрипт <strong>main.js</strong>:</p><h5 id="main-js" tabindex="-1">./main.js <a class="header-anchor" href="#main-js" aria-label="Permalink to &quot;./main.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MyWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my_worker.js?worker&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _myWorker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_myWorker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi there!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_myWorker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>При использовании суффиксальной нотации <strong>worker</strong> Vite оборачивает реализацию в конструктор, который мы можем использовать для инстанцирования нашего web worker. Такой подход делает работу с web workers более похожей на работу с любым другим классом в нашем приложении, поскольку мы можем использовать тот же подход для включения его в наше приложение, и именно этот синтаксис мы будем использовать в наших примерах.</p><p>Кроме того, Vite будет обрабатывать скрипты нашего web worker, поэтому мы можем использовать более привычный синтаксис для импорта ресурсов (<strong>import ... from ...</strong>) вместо родного <strong>self.importScript()</strong>.</p><p>Еще много интересного можно узнать о web workers. Для наших целей этого достаточно, и мы будем использовать именно это. Если вы хотите узнать больше, обратитесь к документации на сайте <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noreferrer">Mozilla Developer Network</a>.</p><p>Получив эти компоненты, мы можем реализовать надежное и удобное соединение с нашими web workers, применяя шаблоны проектирования. Перед этим нам необходимо концептуально изучить еще два шаблона: Business Delegate и Dispatcher.</p><h2 id="шаблон-business-delegate" tabindex="-1">Шаблон Business delegate <a class="header-anchor" href="#шаблон-business-delegate" aria-label="Permalink to &quot;Шаблон Business delegate&quot;">​</a></h2><p>Этот шаблон используется для того, чтобы скрыть сложность доступа к бизнес-сервисам или бизнес-слою от клиента или презентационного слоя, предоставляя единую точку доступа с хорошо определенным и простым интерфейсом.</p><p>Его можно рассматривать как вариант или развитие шаблонов Proxy и Decorator, рассмотренных в главе 2, <em>Принципы и шаблоны проектирования ПО</em>, но в более широком логическом масштабе между архитектурными слоями. Обычно он включает в себя как минимум следующие сущности:</p><ul><li>Сущность <strong>Business delegate</strong>, которая выступает в качестве единой точки входа клиента во все доступные сервисы</li><li>Сущность <strong>Business LookUp или Router</strong>, функция которой состоит в том, чтобы направить выполнение входящего запроса к соответствующему сервису</li><li><strong>Business services</strong>, службы, которые предоставляют общий интерфейс (напрямую или через прокси-шаблон) с предоставляемым ими функционалом</li></ul><p>Для наших целей этот шаблон можно представить в виде следующей диаграммы:</p><p><img src="/assets/Figure_8.04_B18602.CHO74ojz.jpg" alt="image"></p><p>Рисунок 8.4 - Представление шаблона Business delegate</p><p>Этот шаблон может быть применен на нескольких архитектурных уровнях. В нашем конкретном случае мы хотим применить его к нашему приложению с web workers.</p><p>В качестве презентационного слоя мы будем рассматривать родительский процесс, а в качестве бизнес-слоя - web worker. В родительском (или главном) процессе, как обычно, будет находиться наше приложение Vue, ориентированное в первую очередь на обеспечение отличного пользовательского опыта.</p><p>Процесс web worker будет отвечать за предоставление нам доступа к сервисам, либо локальным, как в случае с IndexedDB, либо удаленным, инкапсулируя связь с нашим сервером и дополнительными сервисами, а также любые дополнительные вычислительноемкие функции.</p><p>Такое разделение задач имеет множество преимуществ, причем не только с точки зрения производительности, но и с точки зрения проектирования и реализации приложения в целом.</p><p>Перед тем как приступить к реализации кода для этой главы, необходимо рассмотреть еще один шаблон, который мы будем реализовывать, поскольку мы можем передавать между процессами только сериализуемые данные и не можем выполнять вызовы функций, как это предлагает обычный шаблон Business delegate. Мы расширим идею шаблона Command и будем использовать так называемый шаблон Dispatcher.</p><h2 id="шаблон-dispatcher" tabindex="-1">Шаблон Dispatcher <a class="header-anchor" href="#шаблон-dispatcher" aria-label="Permalink to &quot;Шаблон Dispatcher&quot;">​</a></h2><p>Ранее мы видели, что родительский процесс или рабочий веб-процесс могут инициировать взаимодействие, отправляя друг другу сообщение. Если определен соответствующий слушатель (<strong>onmessage</strong>), то любой из них может получать эти события и реагировать на них.</p><p>В шаблоне Dispatcher эти сообщения содержат информацию, связанную с событием, - например, данные. Ключевым фактором, определяющим этот шаблон проектирования, является то, что <em>сообщения о событиях должны публиковаться между потоками и планироваться для выполнения по их приходу</em>. Разумеется, такое планирование может включать и &quot;немедленное выполнение&quot; некоторой задачи или функции.</p><p>Реализация этого шаблона довольно тривиальна, и можно считать, что он сродни шаблону Command, который мы рассматривали в главе 2, <em>Принципы и шаблоны проектирования программного обеспечения</em>, поэтому больше мы его рассматривать не будем. Вместо этого мы воспользуемся концепциями взаимодействия между потоками, планирования и событий с данными, чтобы создать наше решение для работы с web workers.</p><h2 id="установка-конвеиера-взаимодеиствия-с-веб-рабочим" tabindex="-1">Установка конвейера взаимодействия с веб-рабочим <a class="header-anchor" href="#установка-конвеиера-взаимодеиствия-с-веб-рабочим" aria-label="Permalink to &quot;Установка конвейера взаимодействия с веб-рабочим&quot;">​</a></h2><p>Теперь мы рассмотрели ключевые концепции, которые мы хотим применить в нашей реализации взаимодействия с web workers для нашего Vue-приложения. Эту модель можно использовать многократно от приложения к приложению и совершенствовать по мере необходимости. В качестве общего плана действий вот что мы построим, используя рассмотренные ранее шаблоны проектирования:</p><ul><li>Мы создадим web worker с единой точкой доступа в нашем приложении Vue, следуя шаблону Business Delegate</li><li>Каждое сообщение будет вызывать событие для любого процесса (родитель-работник или работник-родитель) и включать данные о команде и полезной нагрузке, а также информацию об отслеживании для планирования, как в шаблоне Dispatcher</li></ul><p>Достаточно простая архитектура, описанная в предыдущих пунктах, позволяет организовать рабочий процесс, как показано здесь:</p><p><img src="/assets/Figure_8.05_B18602.7UPTcKuU.jpg" alt="image"></p><p>Рисунок 8.5 - Реализация коммуникационного процесса с web worker</p><p>Теперь, когда у нас есть теоретическая база и общее представление о том, что мы будем создавать, пришло время перейти к коду. Мы остановимся на наиболее актуальных частях кода, реализующих упомянутую ранее модель. Чтобы увидеть весь код приложения, пожалуйста, ознакомьтесь с полным исходным кодом из репозитория GitHub.</p><p>Начнем с создания сервиса, который будет нашей точкой входа в клиентское приложение:</p><h5 id="services-webworker-js" tabindex="-1">./services/WebWorker.js <a class="header-anchor" href="#services-webworker-js" aria-label="Permalink to &quot;./services/WebWorker.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WebWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../webworker/index.js?worker&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WebWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    queue: {},                                                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {                            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             id: crypto.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            command,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         service.queue[message.id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {resolve, reject}          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         _worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message);                          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    processMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.success){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             service.queue[id].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.payload)            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             service.queue[id].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service.queue[id];                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     service.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">processMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.data);                        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//9</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service;                                         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//10</span></span></code></pre></div><p>Эта реализация проста, но эффективна. Она хорошо помогает нам понять, как работают эти шаблоны. Начнем с импорта конструктора web worker с использованием специального суффикса Vite <strong>worker</strong> и последующего создания ссылки на экземпляр в строке <em>//1</em>. Как обычно, этот сервис будет синглтоном, поэтому мы создаем его как объект JavaScript, который экспортируем позже в строке <em>//10</em>. У сервиса всего три свойства:</p><ul><li><strong>queue</strong>: Он определяется в строке <em>//2</em> и представляет собой словарь, который мы будем использовать для хранения запланированных обращений к web worker с использованием уникального идентификатора. В каждой записи будет храниться ссылка на методы разрешения обещания (<strong>resolve</strong> и <strong>reject</strong>).</li><li><strong>request()</strong> метод: Определенный здесь в строке //3, он будет использоваться другими сервисами и компонентами (&quot;клиентами&quot;) для запроса задач у web worker. Он всегда возвращает Promise (строка //4). Сообщение, передаваемое web workerу, инкапсулирует <strong>command</strong> и <strong>payload</strong>, полученные в качестве параметров, с уникальным идентификатором. Мы сохраняем ссылки на методы <strong>resolve()</strong> и <strong>reject()</strong> в <strong>queue</strong> (строка //5), и, наконец, используя собственный метод обмена сообщениями web worker, публикуем сообщение в строке //6.</li><li><strong>processMessage()</strong> метод: Здесь мы получаем данные, переданные web workers, и на основании идентификации и результата операции, переданного в атрибуте <strong>.success</strong> (Boolean), обращаемся к <strong>queue</strong> и либо используем функцию <strong>resolve()</strong>, либо <strong>reject()</strong>, чтобы разрешить или отклонить обещание (строка //7). Наконец, мы удаляем ссылку из <strong>queue</strong> в строке //8.</li></ul><p>Последним шагом в этом файле является связывание входящих сообщений, передающих данные непосредственно из web worker в <strong>service.processMessage()</strong> в строке //9. Теперь, наверное, понятно, что мы приняли некоторые решения относительно структуры сообщения, а также ответа. Сообщения состоят из трех компонентов: <strong>id</strong>, <strong>command</strong> и <strong>payload</strong>. Ответы также состоят из трех элементов: <strong>id</strong>, <strong>success</strong> и <strong>payload</strong>. На стороне клиента мы решили оперировать Promise-ами, так как они не имеют &quot;тайм-аута&quot;.</p><p>После того как с клиентской частью разобрались, пришло время поработать над сценарием web worker. Создайте следующий файл <strong>index.js</strong> в каталоге <strong>webworker</strong>:</p><h5 id="webworker-index-js" tabindex="-1">./webworker/index.js <a class="header-anchor" href="#webworker-index-js" aria-label="Permalink to &quot;./webworker/index.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> testService </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./services/test&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> services</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [testService]                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">success</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({id, success, payload})                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {                                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {                           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (service[data.command]) {                        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            service[data.command](data.payload)             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                      sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                      sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Web worker стал еще короче, и мы также приняли некоторые решения относительно интерфейса, реализуемого каждым базовым сервисом: каждый из их методов должен возвращать Promise. Давайте посмотрим код и выясним, почему.</p><p>Начнем со строки //1 с импорта <strong>testService</strong> (мы создадим его позже) и включим его в массив сервисов. Это облегчит добавление новых сервисов путем их импорта и включения в этот массив (это может стать ступенькой к архитектуре плагинов, но пока мы останемся простыми).</p><p>Затем мы определяем глобальную функцию <strong>sendRequest()</strong>, которая будет отправлять родительскому процессу закодированное сообщение с тремя полями: <strong>id</strong>, <strong>success</strong> и <strong>payload</strong>, как и ожидает клиент в данном порядке. Вот что происходит в строке //2.</p><p>В строке //3 мы определяем обработчик события <strong>onmessage</strong> для обработки входящих сообщений. При получении одного из них мы обращаемся к массиву <strong>services</strong> в поисках подходящей команды (строка //4), а когда находим (строка //5), то выполняем функцию, передавая в качестве параметра полезную нагрузку (строка //6) после ее разбора с помощью утилиты JSON.</p><p>Затем, разрешив или отклонив Promise, мы передаем клиенту соответствующий результат в строке <em>//7</em>. Этот короткий фрагмент кода выполняет роль <em>делегатора и диспетчера</em>. Наконец, давайте посмотрим на <strong>testService</strong>, чтобы увидеть, как он работает:</p><h5 id="webworker-services-test-js" tabindex="-1">./webworker/services/test.js <a class="header-anchor" href="#webworker-services-test-js" aria-label="Permalink to &quot;./webworker/services/test.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Web worker жив и работает!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service;</span></span></code></pre></div><p>Как вы можете оценить, этот тестовый сервис не делает ничего особенного, кроме как возвращает Promise и устанавливает таймер на его разрешение через 3 секунды. Эта задержка является искусственной, поскольку в противном случае ответ был бы немедленным. Если запустить пример приложения, то при нажатии на кнопку <strong>Send request</strong> можно увидеть, как через 3 секунды сообщение изменится с <strong>Ожидание...</strong> на <strong>Web worker жив и работает!</strong>, как и ожидалось:</p><p><img src="/assets/Figure_8.06_B18602.CDfTslfk.jpg" alt="image"></p><p>Рисунок 8.6 - Тестовое приложение отправляет команду рабочему и показывает результат</p><p>Для этого в компоненте <strong>App.vue</strong> мы импортируем наш сервис web worker и отправляем запрос со строкой command в качестве имени функции в сервисе, которую мы хотим выполнить. Для данного примера добавим следующий код:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> webWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./services/WebWorker.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">webWorker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>Эти простые строки кода для создания и управления веб-воркером обеспечивают приложению значительный прирост вычислительной мощности и производительности. Теперь, когда все готово, пришло время сделать что-то более существенное с нашим web worker. Давайте обеспечим ему доступ к нашей локальной базе данных и к сети.</p><h2 id="получение-доступа-к-indexeddb-с-помощью-dexiejs-в-web-worker" tabindex="-1">Получение доступа к IndexedDB с помощью DexieJS в web worker. <a class="header-anchor" href="#получение-доступа-к-indexeddb-с-помощью-dexiejs-в-web-worker" aria-label="Permalink to &quot;Получение доступа к IndexedDB с помощью DexieJS в web worker.&quot;">​</a></h2><p>IndexedDB - это очень мощная база данных типа &quot;ключ-значение&quot;, однако ее собственная реализация предоставляет API, с которым довольно сложно работать. Фактически рекомендуется не использовать его, а работать с ним через фреймворк или библиотеку.</p><p>Движок базы данных быстр и очень податлив, поэтому на его основе создано множество библиотек, воссоздающих функции и возможности, отсутствовавшие изначально. Некоторые библиотеки даже имитируют SQL и базы данных на основе документов (document-based). Среди доступных и свободно используемых библиотек можно назвать следующие:</p><ul><li><strong><a href="https://dexie.org/" target="_blank" rel="noreferrer">DexieJS</a></strong>: Очень быстрая и хорошо документированная библиотека, реализующая NoSQL-базу данных на основе документов.</li><li><strong><a href="https://pouchdb.com/" target="_blank" rel="noreferrer">PouchDB</a></strong>: База данных, имитирующая функциональность CouchDB от Apache и обеспечивающая встроенную синхронизацию с удаленными серверами.</li><li><strong><a href="https://rxdb.info/" target="_blank" rel="noreferrer">RxDB</a></strong>: Это база данных, реализующая реактивную модель. Она также поддерживает репликацию в CouchDB.</li><li><strong><a href="https://www.npmjs.com/package/idb" target="_blank" rel="noreferrer">IDB</a></strong>: Это легкая реализация обертки поверх API IndexedDB с некоторыми изменениями для улучшения удобства использования.</li></ul><p>В зависимости от ваших требований к локальному хранилищу, вам подойдут эти или другие варианты. В данном примере мы будем использовать DexieJS, поскольку он хорошо документирован и может похвастаться впечатляющей скоростью выполнения массовых операций.</p><p>Мы расширим наш предыдущий пример и создадим однокомпонентное мини-приложение для хранения, извлечения, удаления и просмотра заметок. Здесь рассматриваются самые основные операции <strong>создания, чтения, обновления и удаления</strong> (<strong>CRUD</strong>). При выполнении кода примера он будет выглядеть примерно так:</p><p><img src="/assets/Figure_8.07_B18602.IJICYCiX.jpg" alt="image"></p><p>Рисунок 8.7 - Пример однокомпонентного CRUD.</p><p>В данном примере можно создавать новые заметки, просматривать ранее сохраненные (они будут постоянными в зависимости от домена), выделять их для просмотра текста, а также удалять. Все операции будут выполняться в web worker. Давайте включим Dexie в наше приложение с помощью <strong>npm</strong>:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dexie</span></span></code></pre></div><p>Следующим шагом создадим наш пример компонентного приложения:</p><h5 id="src-components-dbnotes-vue" tabindex="-1">/src/components/DbNotes.vue <a class="header-anchor" href="#src-components-dbnotes-vue" aria-label="Permalink to &quot;/src/components/DbNotes.vue&quot;">​</a></h5><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> webWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../services/WebWorker&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 //1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ref } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vue&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _notes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]),</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">_note</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({}),</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">_selected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({})          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadNotes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){                                          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_note.value.title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _note.value.text){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       webWorker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;addNote&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_note.value))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadNotes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {_note.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){                                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   WebWorker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deleteNote&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {id})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadNotes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">note</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){_selected.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">note;}                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadNotes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){                                         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   webWorker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;getNotes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {_notes.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {_notes.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;New note&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             v-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_note.title&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             placeholder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">textarea</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_note.text</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             placeholder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Note text...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">textarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saveNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Save&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Notes&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> v-for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _notes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n.id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ n.title }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n.id)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;[X]&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Selected note&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">strong</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ _selected.title }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">strong</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ _selected.text }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>Файл выше очищен от CSS стилей и других элементов оформления, поэтому мы можем сосредоточиться на активных частях кода, реализующих изучаемые операции. Мы начинаем с импорта нашего класса сервиса для работы с web worker в строке <em>//1</em> и создания нескольких внутренних реактивных переменных в строке <em>//2</em>.</p><p>Мы будем использовать <strong>_notes</strong> для хранения полного списка заметок, извлеченного из базы данных, <strong>_note</strong> в качестве заполнителя для создания новых заметок, и <strong>_selected</strong> для отображения заметки, на которую был сделан щелчок в списке.</p><p>Вы можете найти CRUD-операции в каждой функции (строки с <em>//3</em> по <em>//6)</em> и заметите, что они очень похожи, за исключением работы с реактивными элементами пользовательского интерфейса. Они просто собирают необходимую информацию для создания запроса к web worker и затем применяют результат.</p><p>Однако обратите внимание, что в функции <strong>saveNote()</strong>, когда нужно передать объект, описывающий нашу новую заметку, мы клонируем реактивное значение Vue. Это связано с тем, что реализация прокси, которую Vue использует для работы с реактивностью, не является сериализуемой, поэтому, если мы не создадим копию обычного объекта или не применим другие подобные техники для извлечения значений, связь с web worker будет нарушена и выдаст ошибку.</p><p>Простой способ убедиться в том, что объект данных предоставляется в виде клонируемого объекта, - преобразовать его в строку с помощью <strong>JSON.stringify(_note.value)</strong>, как в нашем коде (можно также создать непосредственно клон, используя <strong>JSON.parse(JSON.stringify(_note.value))</strong>.</p><p>Необходимо помнить о том, как будет передаваться информация, чтобы она могла быть правильно обработана на принимающей стороне web worker. Сейчас это станет очевидным, когда мы увидим <strong>dbService.js</strong> в web worker:</p><h5 id="src-webworker-services-dbservice-js" tabindex="-1">./src/webworker/services/dbService.js <a class="header-anchor" href="#src-webworker-services-dbservice-js" aria-label="Permalink to &quot;./src/webworker/services/dbService.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Dexie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dexie&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Dexie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Notes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({notes: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;++id,title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">note</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {                                          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.notes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(note))    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({id:result_id})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err){</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({})}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getNotes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.notes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([])}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteNote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.notes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id)                             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({})}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})}}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service;</span></span></code></pre></div><p>Для использования Dexie мы сначала импортируем конструктор, как в строке <em>//1</em>, и создаем новую базу данных с именем <strong>Notes</strong>. Прежде чем приступить к ее использованию, необходимо определить версию и простую схему таблиц/коллекций с полями, которые будут индексироваться.</p><p>Это и происходит в строке <em>//2</em>, где мы определяем коллекцию <strong>notes</strong> с двумя индексируемыми полями: <strong>id</strong> и <strong>title</strong>. Эти индексированные поля передаются в виде строки, разделенной запятыми по именам полей.</p><p>Мы также включили двойной знак плюс в качестве префикса для поля <strong>id</strong>. Благодаря этому поле автоматически генерируется базой данных и автоматически увеличивается с каждой новой записью.</p><p>Следующая важная функция, <strong>addNote()</strong>, добавляет запись в коллекцию <strong>notes</strong>. Поскольку мы передаем данные, сериализуя объект в виде строки, в нашем компоненте в строке <em>//4</em> необходимо разобрать строку, чтобы перекомпоновать объект.</p><p>В функции <strong>getNotes()</strong> мы просто извлекаем все элементы из коллекции и используем метод <strong>toArray()</strong>, предоставляемый Dexie, который преобразует их в массив JavaScript (строка <em>//5</em>). Таким образом, мы сможем вернуть его непосредственно в качестве результата для разрешения обещания.</p><p>Последнее замечание по этому коду касается метода <strong>deleteNote()</strong>: в строке <em>//6</em> мы не перехватываем результат асинхронной операции. Это связано с тем, что данная операция не возвращает полезного значения. В данном случае эта операция всегда будет разрешаться, если только ошибка движка базы данных не прервет ее выполнение.</p><p>Важно помнить, что ошибки на web worker не повлияют на родительский процесс, и любые операции в нем не будут затронуты.</p><p>После того как мы создали службу, пришло время немного изменить индексный файл web worker. Добавьте следующие строки:</p><h5 id="src-webworker-index-js" tabindex="-1">./src/webworker/index.js <a class="header-anchor" href="#src-webworker-index-js" aria-label="Permalink to &quot;./src/webworker/index.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbService </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./services/dbService&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> services</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [dbService, testService];</span></span></code></pre></div><p>Других изменений в этом файле не требуется. Как видим, для реализации CRUD-операций на web worker требуется не так уж много. Несмотря на то, что их можно выполнять в родительском процессе, а также на небольшой штраф за межпроцессное взаимодействие, выигрыш в производительности значителен и вполне оправдывает затраченные усилия.</p><p>Особенно если наше приложение включает в себя фоновые процессы, такие как синхронизация с удаленным сервером, то они должны выполняться веб-рабочим. Далее рассмотрим, как можно получить доступ к сети и использовать <strong>Representational State Transfer API</strong> (<strong>RESTful API</strong>) также из web worker.</p><p>Одним из наиболее распространенных применений сетевых API сегодня в веб-разработке является реализация RESTful API. Это протокол, в котором каждое сообщение не имеет статистики и представляет собой тип действия, требуемого в месте назначения. Протокол HTTP, используемый в Интернете, идеально подходит для такого типа API, поскольку каждый сетевой вызов раскрывает метод, определяющий тип требуемой операции:</p><ul><li>Операции <strong>GET</strong> позволяют получать данные и файлы</li><li>Операции <strong>PUT</strong> обновляют данные</li><li>Операции <strong>POST</strong> создают новые данные на сервере</li><li>Операции <strong>DELETE</strong> удаляют данные на сервере</li></ul><p>Легко заметить, что эти методы соответствуют операциям CRUD, поэтому, сделав соответствующий сетевой вызов, сервер знает, как обработать данные, полученные в соответствующей конечной точке. Существует множество стандартов, используемых для форматирования данных, передаваемых между конечными точками. В частности, одним из наиболее распространенных является формат JSON, который мы так удобно используем в JavaScript.</p><p>Работа с асинхронными вызовами с помощью собственной реализации в браузере, как минимум, громоздка, но не невозможна. В целях практичности и безопасности рекомендуется использовать известную библиотеку, например <strong>Axios</strong>. Для установки библиотеки необходимо выполнить в терминале следующую команду:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> axios</span></span></code></pre></div><p>Через несколько мгновений библиотека будет установлена в наш проект в качестве зависимости. Библиотека предоставляет очень удобные методы для запуска сетевых вызовов для каждого метода HTTP. Например, <strong>axios.get</strong> выполняет запрос <strong>GET</strong>, <strong>axios.post</strong> - запрос <strong>POST</strong> и т.д.</p><p>В рамках учебного упражнения мы реализуем простую службу, которая будет выполнять сетевые вызовы на удаленный сервер из web worker. Для простоты мы создадим только два метода:</p><h5 id="webworker-services-network-js" tabindex="-1">./webworker/services/network.js <a class="header-anchor" href="#webworker-services-network-js" aria-label="Permalink to &quot;./webworker/services/network.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;axios&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axios.defaults.baseURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        axios</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload.url,{params:{data:payload.data}})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                   resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        axios</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload.url,{data:payload.data})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                  resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})}}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service;</span></span></code></pre></div><p>Этот сервис достаточно прост. В промышленном приложении он будет являться промежуточным звеном для обслуживания других сервисов. В данном примере реализовано всего два метода, соответствующих методам HTTP-запроса. Обратите внимание, что они очень похожи, меняется только название метода и сигнатура некоторых параметров. Первым параметром всегда является конечная точка (URI) для подключения.</p><p>Второй параметр - это либо данные, либо объект с опциями. О том, как обрабатывать каждый конкретный запрос и решать крайние случаи, я отсылаю вас к официальной <a href="https://axios-http.com/docs/intro" target="_blank" rel="noreferrer">документации</a>.</p><p>Следует отметить, что в начале файла мы задаем домен по умолчанию для всех остальных сетевых вызовов. Таким образом, мы избегаем его повторения в каждом вызове. С помощью этой библиотеки мы можем легко задавать специфические HTTP-заголовки и опции, например <strong>JSON Web Tokens</strong> для аутентификации, о чем мы рассказывали в главе 5, <em>Одностраничные приложения</em>, когда упоминали различные методы аутентификации.</p><p>Чтобы включить этот сервис в наш web worker, мы импортируем его и добавим в массив <strong>services</strong>, как мы это делали ранее. Изменим начало этого файла так, чтобы оно выглядело следующим образом:</p><h5 id="webworker-index-js-1" tabindex="-1">./webworker/index.js <a class="header-anchor" href="#webworker-index-js-1" aria-label="Permalink to &quot;./webworker/index.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> netService </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./services/network&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> services</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [dbService, netService, testService]</span></span></code></pre></div><p>С этим новым включением наш web worker готов. Теперь мы реализуем один компонент для тестирования взаимодействия, и он будет выглядеть следующим образом:</p><p><img src="/assets/Figure_8.08_B18602.B8SITemX.jpg" alt="image"></p><p>Рисунок 8.8 - Простой тест, в котором сервер зеркально отражает отправленную информацию.</p><p>Наш компонент позволяет выбрать метод HTTP-запроса (<strong>GET</strong> или <strong>POST</strong>) и отправить произвольные данные. Тестовый сервер будет просто зеркально отражать полученные данные обратно клиенту, где компонент будет отображать их на экране. Реализация достаточно проста:</p><h5 id="src-components-networkcommunication-vue" tabindex="-1">./src/components/NetworkCommunication.vue <a class="header-anchor" href="#src-components-networkcommunication-vue" aria-label="Permalink to &quot;./src/components/NetworkCommunication.vue&quot;">​</a></h5><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> webWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../services/WebWorker&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ref } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vue&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    _data_to_send</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    _data_received</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    _method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    webWorker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_method.value,                            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              {url:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data: _data_to_send.value})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reply</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_data_received.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reply},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_data_received.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Текст для отправки&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;radio&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                           value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;method&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                        v-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;GET Method&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;radio&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                          value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;method&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                        v-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;POST Method&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_data_to_send</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Send&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Данные получены с сервера&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 {{ _data_received }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>В этом компоненте мы импортируем сервис <strong>webWorker</strong> и объявляем три реактивные переменные для отправки и получения данных и одну для хранения выбранного метода для выполнения запроса. Наш простой тестовый сервер будет получать запрос и просто зеркально отражать данные, которые мы отправляем. Позже мы рассмотрим, как создать этот простой сервер с помощью Node.js.</p><p>В шаблоне пользователь может выбрать тип отправляемого запроса (<strong>GET</strong> или <strong>POST</strong>), этот выбор мы сохраняем в переменной <strong>_method</strong>. Это значение мы используем в качестве команды, передаваемой рабочему в строке <em>//1</em>. В качестве полезной нагрузки мы передаем данные в виде объекта-члена. Когда обещание разрешается, мы сохраняем значение из ответа в переменной <strong>_data_received</strong>.</p><p>Остальная часть исходного кода должна быть тривиальна для понимания, так как в ней рассматривается в основном шаблон и представление информации на экране. Прежде чем закончить эту главу, давайте посмотрим, как тестовый сервер может быть реализован с помощью Node.js.</p><h2 id="простои-nodejs-сервер-для-тестирования" tabindex="-1">Простой NodeJS-сервер для тестирования <a class="header-anchor" href="#простои-nodejs-сервер-для-тестирования" aria-label="Permalink to &quot;Простой NodeJS-сервер для тестирования&quot;">​</a></h2><p>Для тестирования сетевых взаимодействий нам представляется целесообразным реализовать небольшой сервер на Node.js для реализации конечных точек, которые мы тестируем. В отдельной директории от нашего приложения Vue откроем окно терминала и введем следующую команду:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span></code></pre></div><p>Мастер командной строки задаст несколько вопросов для создания файла <strong>package.json</strong>, который представляет собой приложение Node.js. После этого выполните эту команду для установки зависимости <strong>Express.js</strong>, которая предоставит нам фреймворк для создания веб-сервера:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> express</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cors</span></span></code></pre></div><p>После завершения процесса создайте файл <strong>index.js</strong> со следующим кодом:</p><h5 id="server-index-js" tabindex="-1">./server/index.js <a class="header-anchor" href="#server-index-js" aria-label="Permalink to &quot;./server/index.js&quot;">​</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> express</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;express&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> express</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                   ;                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())                                             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(express.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())                                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{                          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//6</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.query                                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jsonp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data)                                        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.body                                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//9</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jsonp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{                                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server listening on port &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>С помощью этих нескольких строк кода мы можем запустить небольшой сервер, принимающий и отвечающий на запросы в формате JSON. Мы импортируем конструктор express (строка <em>//1</em>), а также плагин (строка <em>//2</em>). Это важно для того, чтобы мы могли обращаться к этому серверу с любого домена (origin).</p><p><strong>Cross-Origin Request Sharing</strong> (<strong>CORS</strong>) служит для обхода мер безопасности, применяемых серверами для предотвращения обслуживания запросов из других источников (origins), кроме своего собственного. Чтобы разрешить запросы из других источников, его необходимо включить.</p><p>После создания серверного приложения (строка <em>//3</em>) мы передаем плагин (строка <em>//4</em>). Также мы передаем еще один плагин (строка <em>//5</em>), чтобы сервер идентифицировал и отвечал на сетевые вызовы с помощью JSON-объектов. Далее мы создаем две конечные точки, одну для <strong>GET</strong> запросов (строка <em>//6</em>) и вторую для <strong>POST</strong> запроса.</p><p>Первый параметр - это URL, по которому сервер будет прослушивать обращения. В данном случае они одинаковы, так как единственным отличием будет тип метода запроса. Это стандартная практика.</p><p>Каждая конечная точка получает в качестве последнего аргумента функцию обратного вызова, имеющую не менее двух параметров: <strong>req</strong> (запрос) и <strong>res</strong> (ответ). Эти объекты содержат методы и информацию о полученном запросе, а также необходимые методы для создания ответа клиенту.</p><p>Для запросов <strong>GET</strong> полученные данные передаются вместе с URL в виде &quot;строки запроса&quot;, поэтому для доступа к ним <em>Express</em> красиво упаковывает их в виде объекта в поле <strong>request.query</strong> (строка <em>//7</em>).</p><p>Поскольку мы просто отвечаем теми же полученными данными, в строке <em>//8</em> мы используем объект <strong>res</strong> для создания дополненного JSON-ответа с тем же объектом данных. Мы делаем это потому, что считаем, что можем получать вызовы из любого домена (поскольку включили CORS), и хотим быть уверены, что ответ будет полностью понятен. <strong>JSON with Padding</strong> (<strong>JSONP</strong>) - это метод отправки ответа с помощью другого метода. Нам не нужно беспокоиться об этом, так как оба конца (отправитель и получатель) обрабатываются сервером Express и клиентом Axios.</p><p>В методе <strong>post</strong> разница заключается в том, что данные содержатся в теле сообщения (строка <em>//9</em>), отсюда и разная обработка. Наконец, сервер начинает прослушивать указанный порт (строка <em>//10</em>). Теперь мы можем обращаться к серверу по адресу <code>http://localhost:3000/</code>, который мы настроили в нашей сетевой службе как адрес по умолчанию для Axios.</p><p>В результате мы получили возможность работать с сервером по адресу <code>http://localhost:3000/</code>.</p><p>После создания этого сервера мы можем провести полное тестирование всех частей системы.</p><h2 id="подведение-итогов" tabindex="-1">Подведение итогов <a class="header-anchor" href="#подведение-итогов" aria-label="Permalink to &quot;Подведение итогов&quot;">​</a></h2><p>В этой главе мы рассмотрели несколько очень важных концепций, позволяющих кардинально улучшить архитектуру и производительность нашего приложения. Web workers - это удивительная технология, позволяющая веб-приложениям использовать преимущества современных аппаратных архитектур и современных операционных систем.</p><p>С точки зрения стационарности, многопоточность с использованием web workers не требует особых дополнительных усилий и сложностей, а выигрыш от ее применения весьма ощутим. Мы также увидели, как использовать web workers для доступа к сетевым сервисам, а также к локальной постоянной базе данных, предоставляемой браузером (IndexedDB).</p><p>Мы познакомились еще с двумя шаблонами проектирования для реализации масштабируемой архитектуры нашего приложения и проверили их концепции и реализацию на примере простых компонентов и сервисов. Использование web workers значительно повышает производительность и качество выполнения хорошо спроектированного веб-приложения.</p><p>В следующей главе мы рассмотрим инструменты и методы автоматического тестирования нашего кода, обеспечивающие соответствие отдельных его частей своему назначению в соответствии со спецификациями и требованиями к программному обеспечению.</p><h2 id="вопросы-для-проверки" tabindex="-1">Вопросы для проверки <a class="header-anchor" href="#вопросы-для-проверки" aria-label="Permalink to &quot;Вопросы для проверки&quot;">​</a></h2><ul><li>Какие ограничения JavaScript могут повлиять на производительность веб-приложения?</li><li>Что такое web workers? Каковы их ограничения?</li><li>Как приложения Vue могут взаимодействовать с web workers?</li><li>Какие преимущества дает использование такого шаблона проектирования, как Business delegate, для работы с web workers?</li><li>Что можно изменить в коде примера, чтобы управлять несколькими web workers, а не одним? В каких случаях, по вашему мнению, это целесообразно?</li></ul></div></div></main><footer class="VPDocFooter" data-v-bd65f111 data-v-f9b7cb1b><!--[--><!--]--><div class="edit-info" data-v-f9b7cb1b><!----><div class="last-updated" data-v-f9b7cb1b><p class="VPLastUpdated" data-v-f9b7cb1b data-v-d04b7ca3>Последнее обновление: <time datetime="2024-10-22T02:21:06.000Z" data-v-d04b7ca3></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-f9b7cb1b><span class="visually-hidden" id="doc-footer-aria-label" data-v-f9b7cb1b>Pager</span><div class="pager" data-v-f9b7cb1b><a class="VPLink link pager-link prev" href="/ru/book/Chapter_7__Data_Flow_Management.html" data-v-f9b7cb1b><!--[--><span class="desc" data-v-f9b7cb1b>Previous page</span><span class="title" data-v-f9b7cb1b>Глава 7: Управление потоком данных</span><!--]--></a></div><div class="pager" data-v-f9b7cb1b><a class="VPLink link pager-link next" href="/ru/book/Chapter_9__Testing_and_Source_Control.html" data-v-f9b7cb1b><!--[--><span class="desc" data-v-f9b7cb1b>Next page</span><span class="title" data-v-f9b7cb1b>Глава 9: Тестирование и системы контроля версий</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"en_deployment_docker.md\":\"B0WKNeh5\",\"en_backend_cors.md\":\"DZtXLSWs\",\"en_backend_backend.md\":\"GmUUIFyQ\",\"en_misc_glossary.md\":\"BIXA_p9w\",\"en_backend_protocols.md\":\"Cm6M26E3\",\"en_development_building.md\":\"CrijnQz1\",\"en_development_assets.md\":\"BfGxiId0\",\"en_development_misc.md\":\"BW4624Iv\",\"en_frontend_about-frameworks.md\":\"DQpfvCSY\",\"en_frontend_css-ui-libs.md\":\"6B-3Tscj\",\"en_index.md\":\"Don6XAen\",\"en_deployment_ci-cd.md\":\"oY0VB76B\",\"en_misc_changelog.md\":\"Deylk5sT\",\"en_misc_contribute.md\":\"DCCRKqUK\",\"en_development_ide.md\":\"DDoYaiip\",\"en_vue-webapp_objectives.md\":\"BqiQckaZ\",\"en_release-timeline_web-component.md\":\"CQhR9ayk\",\"en_vue-webapp_guidelines.md\":\"BWoj5e3u\",\"ru_arty-crafty_showcase_customization.md\":\"Bj1rMQFJ\",\"en_vue-webapp_options_layout-one-column.md\":\"C2o5UpX_\",\"en_vue-webapp_options_drawer.md\":\"sbHq2bUF\",\"en_release-timeline_index.md\":\"Bl3B8oCJ\",\"en_deployment_hosting.md\":\"BB6Tx_LV\",\"en_vue-webapp_options_pwa.md\":\"DDR6pvjA\",\"en_development_testing.md\":\"CMd0qyoc\",\"en_frontend_learning.md\":\"BORnwTfX\",\"ru_book_appendix__migrating_from_vue_2.md\":\"CM4UoAba\",\"en_vue-webapp_options_google-analytics.md\":\"CJdktosW\",\"en_vue-webapp_options_baseicon.md\":\"DM9N_rUF\",\"en_vue-webapp_options_header.md\":\"j71zhreM\",\"en_vue-webapp_options_navbar.md\":\"DCMPc1YW\",\"en_vue-webapp_options_open-graph.md\":\"qOvtfTin\",\"en_vue-webapp_index.md\":\"CfuSIlpW\",\"index.md\":\"DcxOWamt\",\"ru_articles_index.md\":\"vb14J7W3\",\"en_vue-webapp_options_themes.md\":\"Cy6Sm3rZ\",\"ru_arty-crafty_analysis_architecture-and-design.md\":\"EfMn4dDZ\",\"ru_arty-crafty_analysis_business-analysis.md\":\"4BkL2pJh\",\"ru_book_chapter_10__deploying_your_application.md\":\"DKBsWvj4\",\"ru_arty-crafty_analysis_ui-layout.md\":\"BTq2XKH7\",\"ru_arty-crafty_backend_hoppscotch.md\":\"SXOv-Yqa\",\"ru_arty-crafty_analysis_ui-design.md\":\"C7_Yxg4a\",\"ru_arty-crafty_backend_db-data-model.md\":\"fR_a14a1\",\"ru_arty-crafty_introduction_development-stages.md\":\"BxwpUsVh\",\"ru_arty-crafty_backend_supabase-api.md\":\"In6jzObK\",\"ru_arty-crafty_introduction_goals.md\":\"BqaWwEjt\",\"ru_arty-crafty_showcase-data_api-service-adapter.md\":\"CAzLk80M\",\"ru_arty-crafty_backend_baas-choosing.md\":\"COt7lneA\",\"ru_arty-crafty_index.md\":\"CJFrYDOq\",\"ru_arty-crafty_showcase_product-category.md\":\"NslQEk6_\",\"ru_arty-crafty_backend_supabase.md\":\"CHoLRfx8\",\"ru_arty-crafty_introduction_repository.md\":\"BWR8lxqB\",\"ru_arty-crafty_showcase-data_mobile-menu.md\":\"C-mDmukZ\",\"ru_arty-crafty_showcase-data_product-page.md\":\"DzgB3hZJ\",\"ru_arty-crafty_showcase_project-setup.md\":\"CHvzQiOg\",\"ru_arty-crafty_showcase-data_typescript.md\":\"BW7yUztG\",\"en_backend_auth.md\":\"5RqrGWaq\",\"en_backend_api.md\":\"BcdP4mWz\",\"ru_backend_protocols.md\":\"DG7itCBj\",\"ru_arty-crafty_showcase_codeium.md\":\"f4bJWEKD\",\"ru_arty-crafty_showcase-data_vueuse.md\":\"v7VVDd0B\",\"en_release-timeline_config.md\":\"jVV2t3AZ\",\"en_vue-webapp_options_adaptability.md\":\"CDhCJrys\",\"en_release-timeline_getting-data.md\":\"BzR0m4FZ\",\"en_misc_cheat-sheets.md\":\"CvgHwqHF\",\"en_vue-webapp_getting-started.md\":\"BOBEu5iz\",\"ru_arty-crafty_showcase_favourites.md\":\"ClTj79oQ\",\"en_vue-webapp_options_index.md\":\"DZ0USHac\",\"en_vue-webapp_options_layout-main.md\":\"DlLpKUbf\",\"en_release-timeline_vitepress.md\":\"BveX6YQo\",\"en_release-timeline_microfrontend.md\":\"BCHC0RKh\",\"en_development_stores.md\":\"KW0AvzcP\",\"en_development_architectural-patterns.md\":\"B1J2640e\",\"en_vue-webapp_options_description.md\":\"CkmtUSCs\",\"en_development_project-structure.md\":\"C3YhoDcY\",\"en_frontend_spa-pwa-ssr-ssg.md\":\"B_pIXce2\",\"en_release-timeline_getting-started.md\":\"vOJ8d5qU\",\"en_development_libraries.md\":\"D1bcwAJk\",\"en_frontend_architecture.md\":\"ASXQ0ewT\",\"ru_arty-crafty_analysis_data-model.md\":\"BGt3zB-j\",\"ru_arty-crafty_analysis_tech-stack.md\":\"CGS0QX_O\",\"ru_arty-crafty_analysis_research.md\":\"C5tcmffu\",\"en_vue-webapp_options_ga-gp.md\":\"B34sioYH\",\"en_vue-webapp_options_footer.md\":\"BI0rC-bj\",\"en_misc_introduction.md\":\"tWEI139o\",\"en_vue-webapp_options_splash-screen.md\":\"C1kz0J26\",\"ru_backend_cors.md\":\"5zm0FnYw\",\"ru_backend_backend.md\":\"9hMlYOVg\",\"en_vue-webapp_contribution.md\":\"DmyseCH4\",\"en_vue-webapp_options_i18n.md\":\"Bx69LGnR\",\"en_vue-webapp_options_api.md\":\"BwJ73DBV\",\"ru_backend_auth.md\":\"CQ3_Z-ZR\",\"ru_backend_api.md\":\"B4ZiKtbS\",\"en_release-timeline_vue-3.md\":\"CEKBZrod\",\"en_release-timeline_release-history.md\":\"C8GqWfxF\",\"ru_book_chapter_1__the_vue_3_framework.md\":\"BbNPiiHr\",\"en_deployment_github-actions.md\":\"CawPEMyk\",\"ru_book_chapter_6__progressive_web_applications.md\":\"DPRZE9-T\",\"ru_development_testing.md\":\"C-ZoQxcB\",\"ru_development_web-components.md\":\"DXwLxDwn\",\"ru_frontend_about-frameworks.md\":\"D4zMQVDJ\",\"ru_development_stores.md\":\"DPbFm8Uv\",\"ru_frontend_css-ui-libs.md\":\"FAkgxqvM\",\"ru_frontend_learning.md\":\"DtO6sdO0\",\"ru_development_ide.md\":\"MdZw00QL\",\"ru_development_libraries.md\":\"Bafz-URO\",\"ru_development_misc.md\":\"Rv95e2l7\",\"ru_frontend_architecture.md\":\"Bk6l16e5\",\"ru_deployment_ci-cd.md\":\"BwuFEdi3\",\"ru_book_summary.md\":\"u45J_Wjr\",\"ru_deployment_docker.md\":\"BiH6E_C8\",\"ru_development_architectural-patterns.md\":\"BcMmPpVT\",\"ru_deployment_github-actions.md\":\"BnLQsj_O\",\"ru_book_chapter_5__single-page_applications.md\":\"CO5SDr9u\",\"ru_deployment_hosting.md\":\"CECpEzUP\",\"ru_development_assets.md\":\"CF2OOSke\",\"ru_book_chapter_4__user_interface_composition_with_components.md\":\"COLvk40b\",\"ru_book_chapter_3__setting_up_a_working_project.md\":\"DRCl3rA2\",\"ru_book_chapter_11__bonus_chapter_-_ux_patterns.md\":\"Crhi8swE\",\"ru_release-timeline_index.md\":\"BNajCcaC\",\"ru_book_chapter_2__software_design_principles_and_patterns.md\":\"CJ26zbd4\",\"ru_release-timeline_microfrontend.md\":\"DMMQHjDS\",\"ru_vue-webapp_options_adaptability.md\":\"DtUkuIYI\",\"ru_vue-webapp_index.md\":\"DPHy0Jgm\",\"ru_vue-webapp_options_api.md\":\"B8UOaePD\",\"ru_release-timeline_vitepress.md\":\"Bm4D58u0\",\"ru_release-timeline_vue-3.md\":\"D2lpM1Mb\",\"ru_vue-webapp_objectives.md\":\"C_pCXPIi\",\"ru_vue-webapp_contribution.md\":\"2Z2IWKU0\",\"ru_release-timeline_web-component.md\":\"DDC9skvO\",\"ru_vue-webapp_guidelines.md\":\"BYg9CxBO\",\"ru_vue-webapp_options_splash-screen.md\":\"DNt6o_5D\",\"ru_index.md\":\"CwvbRCeB\",\"ru_vue-webapp_options_themes.md\":\"4tTS2l9m\",\"ru_misc_cheat-sheets.md\":\"DRSf9Kns\",\"ru_misc_contribute.md\":\"CqAhLEYi\",\"ru_misc_glossary.md\":\"Dhb3btZn\",\"ru_vue-webapp_options_baseicon.md\":\"CobGq7LU\",\"ru_release-timeline_getting-started.md\":\"Zr6iscXj\",\"ru_misc_changelog.md\":\"r0aQ2xiV\",\"ru_vue-webapp_options_pwa.md\":\"BGeB4pCj\",\"ru_release-timeline_release-history.md\":\"6d-RlUlz\",\"ru_vue-webapp_options_drawer.md\":\"Ddc4Twyb\",\"ru_vue-webapp_options_footer.md\":\"DVF2xtfk\",\"ru_vue-webapp_options_header.md\":\"Gx3IFA2w\",\"ru_vue-webapp_options_description.md\":\"BSPLdeww\",\"ru_vue-webapp_options_layout-main.md\":\"31Dgvgl8\",\"ru_misc_introduction.md\":\"B8RynyVG\",\"ru_release-timeline_getting-data.md\":\"qnJ6IpVX\",\"ru_vue-webapp_options_i18n.md\":\"EmRNF1nM\",\"ru_vue-webapp_options_navbar.md\":\"CDE2tLkd\",\"ru_vue-webapp_options_index.md\":\"DLbMpY-p\",\"ru_release-timeline_config.md\":\"DxhYceFM\",\"ru_vue-webapp_options_google-analytics.md\":\"ClMz-0NP\",\"ru_vue-webapp_options_layout-one-column.md\":\"BYZ2oCvl\",\"ru_vue-webapp_options_open-graph.md\":\"Dw8r9oxd\",\"ru_vue-webapp_options_ga-gp.md\":\"CTmBP9uQ\",\"ru_frontend_spa-pwa-ssr-ssg.md\":\"Fxkrhis7\",\"ru_development_building.md\":\"DTUeepZG\",\"ru_development_project-structure.md\":\"Cxvfocu-\",\"ru_vue-webapp_getting-started.md\":\"Cv1XWZBW\",\"ru_book_index.md\":\"BkI-rhRK\",\"ru_book_chapter_8__multithreading_with_web_workers.md\":\"DsOwuZtC\",\"ru_book_chapter_7__data_flow_management.md\":\"XHRCWifd\",\"ru_book_chapter_9__testing_and_source_control.md\":\"m-7w8WQf\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en\",\"dir\":\"ltr\",\"title\":\"Vue FAQ\",\"description\":\"Vue FAQ - information about Vue.js and frontend development in general\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/images/vue-faq-logo.webp\",\"nav\":[{\"text\":\"Home\",\"link\":\"/en/\"},{\"text\":\"FAQ\",\"link\":\"/en/misc/introduction\"},{\"text\":\"Release Timeline\",\"link\":\"/en/release-timeline/\"},{\"text\":\"vue-webapp\",\"link\":\"/en/vue-webapp/\"},{\"text\":\"v 1.4\",\"items\":[{\"text\":\"Changelog\",\"link\":\"/en/misc/CHANGELOG.md\"},{\"text\":\"Contribute\",\"link\":\"/en/misc/contribute.md\"}]}],\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuesence/vue-faq\"},{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><text font-weight=\\\"bold\\\" xml:space=\\\"preserve\\\" font-size=\\\"18\\\" id=\\\"svg_1\\\" y=\\\"16\\\" x=\\\"8\\\" fill=\\\"currentColor\\\">Star it!</text></g></svg>\"},\"link\":\"https://github.com/vuesence/vue-faq\"}]},\"locales\":{\"ru\":{\"lang\":\"ru\",\"label\":\"Русский\",\"description\":\"Vue FAQ - информация о фреймворке Vue.js и фронтенд разработке в целом\",\"themeConfig\":{\"nav\":[{\"text\":\"FAQ\",\"link\":\"/ru/misc/introduction\"},{\"text\":\"Учебник\",\"link\":\"/ru/book/\"},{\"text\":\"vue-webapp\",\"link\":\"/ru/vue-webapp/\"},{\"text\":\"Release Timeline\",\"link\":\"/ru/release-timeline/\"},{\"text\":\"Arty-Crafty\",\"link\":\"/ru/arty-crafty/\"},{\"text\":\"Статьи\",\"link\":\"/ru/articles/\"},{\"text\":\"v 1.4\",\"items\":[{\"text\":\"Changelog\",\"link\":\"/ru/misc/CHANGELOG.md\"},{\"text\":\"Внести вклад\",\"link\":\"/ru/misc/contribute.md\"},{\"text\":\"@vuejs_ru\",\"title\":\"Телеграм сообщество\",\"link\":\"https://t.me/vuejs_ru\"},{\"text\":\"@/r/vuejs/\",\"link\":\"https://www.reddit.com/r/vuejs/\"}]}],\"sidebar\":{\"/ru/\":[{\"text\":\"Предисловие\",\"link\":\"/ru/misc/introduction\"},{\"text\":\"Фронтенд\",\"items\":[{\"text\":\"О фронтенд фреймворках\",\"link\":\"/ru/frontend/about-frameworks\"},{\"text\":\"Как изучать Vue?\",\"link\":\"/ru/frontend/learning\"},{\"text\":\"SPA, PWA, SSG, SSR и SEO\",\"link\":\"/ru/frontend/spa-pwa-ssr-ssg\"},{\"text\":\"CSS и UI библиотеки\",\"link\":\"/ru/frontend/css-ui-libs\"},{\"text\":\"Архитектура фронтенд приложений\",\"link\":\"/ru/frontend/architecture\"}]},{\"text\":\"Разработка\",\"items\":[{\"text\":\"Настройка IDE\",\"link\":\"/ru/development/ide\"},{\"text\":\"Создание и сборка приложения\",\"link\":\"/ru/development/building\"},{\"text\":\"Структура проекта\",\"link\":\"/ru/development/project-structure\"},{\"text\":\"Архитектурные решения\",\"link\":\"/ru/development/architectural-patterns\"},{\"text\":\"Как вставлять картинки и другие ресурсы\",\"link\":\"/ru/development/assets\"},{\"text\":\"Сторы - Vuex, Pinia и Composition API\",\"link\":\"/ru/development/stores\"},{\"text\":\"Тестирование\",\"link\":\"/ru/development/testing\"},{\"text\":\"Web components\",\"link\":\"/ru/development/web-components\"},{\"text\":\"Полезные советы\",\"link\":\"/ru/development/misc\"}]},{\"text\":\"Бэкенд\",\"items\":[{\"text\":\"Авторизация и аутентификация\",\"link\":\"/ru/backend/auth\"},{\"text\":\"Протоколы. To REST или не REST?\",\"link\":\"/ru/backend/protocols\"},{\"text\":\"API сервис\",\"link\":\"/ru/backend/api\"},{\"text\":\"Варианты сделать бэкенд\",\"link\":\"/ru/backend/backend\"},{\"text\":\"CORS\",\"link\":\"/ru/backend/cors\"}]},{\"text\":\"Деплой на сервере\",\"items\":[{\"text\":\"CI/CD\",\"link\":\"/ru/deployment/ci-cd\"},{\"text\":\"Github Actions\",\"link\":\"/ru/deployment/github-actions\"},{\"text\":\"Варианты размещения сайта\",\"link\":\"/ru/deployment/hosting\"}]},{\"text\":\"Шпаргалки\",\"link\":\"/ru/misc/cheat-sheets\"},{\"text\":\"Глоссарий\",\"link\":\"/ru/misc/glossary\"},{\"text\":\"Дополнить этот FAQ\",\"link\":\"/ru/misc/contribute\"}],\"/ru/book/\":[{\"text\":\"Предисловие\",\"link\":\"/ru/book/\"},{\"text\":\"Краткое содержание\",\"link\":\"/ru/book/summary\"},{\"text\":\"Глава 1: Фреймворк Vue 3\",\"link\":\"/ru/book/Chapter_1__The_Vue_3_Framework\"},{\"text\":\"Глава 2: Принципы и шаблоны проектирования программного обеспечения\",\"link\":\"/ru/book/Chapter_2__Software_Design_Principles_and_Patterns\"},{\"text\":\"Глава 3: Установка рабочего проекта\",\"link\":\"/ru/book/Chapter_3__Setting_Up_a_Working_Project\"},{\"text\":\"Глава 4: Композиция пользовательского интерфейса с помощью компонентов\",\"link\":\"/ru/book/Chapter_4__User_Interface_Composition_with_Components\"},{\"text\":\"Глава 5: Одностраничные приложения (SPA)\",\"link\":\"/ru/book/Chapter_5__Single-Page_Applications\"},{\"text\":\"Глава 6: Прогрессивные веб-приложения\",\"link\":\"/ru/book/Chapter_6__Progressive_Web_Applications\"},{\"text\":\"Глава 7: Управление потоком данных\",\"link\":\"/ru/book/Chapter_7__Data_Flow_Management\"},{\"text\":\"Глава 8: Многопоточность с Web Workers\",\"link\":\"/ru/book/Chapter_8__Multithreading_with_Web_Workers\"},{\"text\":\"Глава 9: Тестирование и системы контроля версий\",\"link\":\"/ru/book/Chapter_9__Testing_and_Source_Control\"},{\"text\":\"Глава 10: Развертывание приложения\",\"link\":\"/ru/book/Chapter_10__Deploying_Your_Application\"},{\"text\":\"Глава 11: Бонусная глава - Шаблоны UX\",\"link\":\"/ru/book/Chapter_11__Bonus_Chapter_-_UX_Patterns\"},{\"text\":\"Приложение: Миграция с Vue 2 на Vue 3\",\"link\":\"/ru/book/Appendix__Migrating_from_Vue_2\"}],\"/ru/vue-webapp/\":[{\"text\":\"О приложении\",\"link\":\"/ru/vue-webapp/\"},{\"text\":\"Установка\",\"link\":\"/ru/vue-webapp/getting-started\"},{\"text\":\"Цели\",\"link\":\"/ru/vue-webapp/objectives\"},{\"text\":\"Принципы\",\"link\":\"/ru/vue-webapp/guidelines\"},{\"text\":\"Участие в проекте\",\"link\":\"/ru/vue-webapp/contribution\"},{\"text\":\"Опции\",\"link\":\"/ru/vue-webapp/options/index\",\"items\":[{\"text\":\"Макеты приложения\",\"collapsed\":false,\"items\":[{\"text\":\"MainLayout\",\"link\":\"/ru/vue-webapp/options/layout-main\"},{\"text\":\"OneColumnLayout\",\"link\":\"/ru/vue-webapp/options/layout-one-column\"}]},{\"text\":\"Компоненты приложения\",\"collapsed\":false,\"items\":[{\"text\":\"Header\",\"link\":\"/ru/vue-webapp/options/header\"},{\"text\":\"Footer\",\"link\":\"/ru/vue-webapp/options/footer\"},{\"text\":\"Navigation drawer\",\"link\":\"/ru/vue-webapp/options/drawer\"},{\"text\":\"Navbar\",\"link\":\"/ru/vue-webapp/options/navbar\"},{\"text\":\"BaseIcon\",\"link\":\"/ru/vue-webapp/options/baseIcon\"}]},{\"text\":\"Функциональность\",\"collapsed\":false,\"items\":[{\"text\":\"Описание\",\"link\":\"/ru/vue-webapp/options/description\"},{\"text\":\"Адаптивность\",\"link\":\"/ru/vue-webapp/options/adaptability\"},{\"text\":\"Themes\",\"link\":\"/ru/vue-webapp/options/themes\"},{\"text\":\"Splash screen\",\"link\":\"/ru/vue-webapp/options/splash-screen\"},{\"text\":\"Google analytics\",\"link\":\"/ru/vue-webapp/options/google-analytics\"},{\"text\":\"Open graph\",\"link\":\"/ru/vue-webapp/options/open-graph\"},{\"text\":\"API модуль\",\"link\":\"/ru/vue-webapp/options/api\"},{\"text\":\"PWA\",\"link\":\"/ru/vue-webapp/options/pwa\"},{\"text\":\"Github Pages deploy\",\"link\":\"/ru/vue-webapp/options/ga-gp\"},{\"text\":\"i18n\",\"link\":\"/ru/vue-webapp/options/i18n\"}]}]}],\"/ru/arty-crafty/\":[{\"text\":\"О проекте\",\"link\":\"/ru/arty-crafty/index\"},{\"text\":\"Предисловие\",\"items\":[{\"text\":\"Цели и задачи\",\"link\":\"/ru/arty-crafty/introduction/goals\"},{\"text\":\"План работы\",\"link\":\"/ru/arty-crafty/introduction/development-stages\"},{\"text\":\"Репозиторий и сайт\",\"link\":\"/ru/arty-crafty/introduction/repository\"}]},{\"text\":\"Анализ\",\"items\":[{\"text\":\"Функционал\",\"collapsed\":false,\"items\":[{\"text\":\"Бизнес анализ\",\"link\":\"/ru/arty-crafty/analysis/business-analysis\"},{\"text\":\"Архитектура приложения\",\"link\":\"/ru/arty-crafty/analysis/architecture-and-design\"},{\"text\":\"Модель данных\",\"link\":\"/ru/arty-crafty/analysis/data-model\"},{\"text\":\"Технический стек\",\"link\":\"/ru/arty-crafty/analysis/tech-stack\"}]},{\"text\":\"UI/UX\",\"collapsed\":false,\"items\":[{\"text\":\"Анализ рынка\",\"link\":\"/ru/arty-crafty/analysis/research\"},{\"text\":\"Макет\",\"link\":\"/ru/arty-crafty/analysis/ui-layout\"},{\"text\":\"Дизайн\",\"link\":\"/ru/arty-crafty/analysis/ui-design\"}]}]},{\"text\":\"Разработка\",\"items\":[{\"text\":\"Витрина\",\"collapsed\":false,\"items\":[{\"text\":\"Создание проекта\",\"link\":\"/ru/arty-crafty/showcase/project-setup\"},{\"text\":\"Кастомизация\",\"link\":\"/ru/arty-crafty/showcase/customization\"},{\"text\":\"Категория товаров\",\"link\":\"/ru/arty-crafty/showcase/product-category\"},{\"text\":\"'Избранное'\",\"link\":\"/ru/arty-crafty/showcase/favourites\"},{\"text\":\"Codeium\",\"link\":\"/ru/arty-crafty/showcase/codeium\"}]},{\"text\":\"Бэкенд и база данных\",\"collapsed\":false,\"items\":[{\"text\":\"Выбор BaaS\",\"link\":\"/ru/arty-crafty/backend/baas-choosing\"},{\"text\":\"Supabase\",\"link\":\"/ru/arty-crafty/backend/supabase\"},{\"text\":\"Модель данных\",\"link\":\"/ru/arty-crafty/backend/db-data-model\"},{\"text\":\"Supabase API\",\"link\":\"/ru/arty-crafty/backend/supabase-api\"},{\"text\":\"Hoppscotch\",\"link\":\"/ru/arty-crafty/backend/hoppscotch\"}]},{\"text\":\"Витрина -  данные\",\"collapsed\":false,\"items\":[{\"text\":\"API сервис адаптер\",\"link\":\"/ru/arty-crafty/showcase-data/api-service-adapter\"},{\"text\":\"Мобильное меню, CSS\",\"link\":\"/ru/arty-crafty/showcase-data/mobile-menu\"},{\"text\":\"VueUse\",\"link\":\"/ru/arty-crafty/showcase-data/vueuse\"}]}]}],\"/ru/release-timeline/\":[{\"text\":\"О библиотеке\",\"link\":\"/ru/release-timeline/index\"},{\"text\":\"Установка\",\"collapsed\":false,\"items\":[{\"text\":\"Во Vue 3 проект\",\"link\":\"/ru/release-timeline/vue-3\"},{\"text\":\"В VitePress\",\"link\":\"/ru/release-timeline/vitepress\"},{\"text\":\"Как микрофронтенд\",\"link\":\"/ru/release-timeline/microfrontend\"},{\"text\":\"Web component\",\"link\":\"/ru/release-timeline/web-component\"}]},{\"text\":\"Конфигурация\",\"link\":\"/ru/release-timeline/config\"},{\"text\":\"Получение данных\",\"link\":\"/ru/release-timeline/getting-data\"},{\"text\":\"История релизов\",\"link\":\"/ru/release-timeline/release-history\"}]},\"lastUpdated\":{\"text\":\"Последнее обновление\"},\"outline\":{\"label\":\"Содержание\"},\"returnToTopLabel\":\"Наверх\",\"socialLinks\":[{\"icon\":{\"svg\":\"<svg id=\\\"Livello_1\\\" data-name=\\\"Livello 1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" viewBox=\\\"0 0 240 240\\\"><circle cx=\\\"120\\\" cy=\\\"120\\\" r=\\\"120\\\" fill=\\\"#1d93d2\\\"></circle><path d=\\\"M81.229,128.772l14.237,39.406s1.78,3.687,3.686,3.687,30.255-29.492,30.255-29.492l31.525-60.89L81.737,118.6Z\\\" fill=\\\"#c8daea\\\"></path><path d=\\\"M100.106,138.878l-2.733,29.046s-1.144,8.9,7.754,0,17.415-15.763,17.415-15.763\\\" fill=\\\"#a9c6d8\\\"></path><path d=\\\"M81.486,130.178,52.2,120.636s-3.5-1.42-2.373-4.64c.232-.664.7-1.229,2.1-2.2,6.489-4.523,120.106-45.36,120.106-45.36s3.208-1.081,5.1-.362a2.766,2.766,0,0,1,1.885,2.055,9.357,9.357,0,0,1,.254,2.585c-.009.752-.1,1.449-.169,2.542-.692,11.165-21.4,94.493-21.4,94.493s-1.239,4.876-5.678,5.043A8.13,8.13,0,0,1,146.1,172.5c-8.711-7.493-38.819-27.727-45.472-32.177a1.27,1.27,0,0,1-.546-.9c-.093-.469.417-1.05.417-1.05s52.426-46.6,53.821-51.492c.108-.379-.3-.566-.848-.4-3.482,1.281-63.844,39.4-70.506,43.607A3.21,3.21,0,0,1,81.486,130.178Z\\\" fill=\\\"#fff\\\"></path></svg>\"},\"link\":\"https://t.me/vuefaq\"},{\"icon\":\"github\",\"link\":\"https://github.com/vuesence/vue-faq\"},{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><text font-weight=\\\"bold\\\" xml:space=\\\"preserve\\\" font-size=\\\"18\\\" id=\\\"svg_1\\\" y=\\\"16\\\" x=\\\"8\\\" fill=\\\"currentColor\\\">Star it!</text></g></svg>\"},\"link\":\"https://github.com/vuesence/vue-faq\"}]},\"head\":[[\"meta\",{\"property\":\"og:description\",\"content\":\"Vue FAQ - информация о фреймворке Vue.js и фронтенд разработке в целом\"}],[\"script\",{\"async\":\"\",\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-JL65GWRNZZ\"}],[\"script\",{},\"window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-JL65GWRNZZ');\"]]},\"en\":{\"lang\":\"en\",\"label\":\"English\",\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/en/\"},{\"text\":\"FAQ\",\"link\":\"/en/misc/introduction\"},{\"text\":\"Release Timeline\",\"link\":\"/en/release-timeline/\"},{\"text\":\"vue-webapp\",\"link\":\"/en/vue-webapp/\"},{\"text\":\"v 1.4\",\"items\":[{\"text\":\"Changelog\",\"link\":\"/en/misc/CHANGELOG.md\"},{\"text\":\"Contribute\",\"link\":\"/en/misc/contribute.md\"}]}],\"sidebar\":{\"/en/\":[{\"text\":\"Introduction\",\"link\":\"/en/misc/introduction\"},{\"text\":\"Frontend\",\"items\":[{\"text\":\"About frontend frameworks\",\"link\":\"/en/frontend/about-frameworks\"},{\"text\":\"How to learn Vue?\",\"link\":\"/en/frontend/learning\"},{\"text\":\"SPA, PWA, SSG, SSR and SEO\",\"link\":\"/en/frontend/spa-pwa-ssr-ssg\"},{\"text\":\"CSS and UI libraries\",\"link\":\"/en/frontend/css-ui-libs\"},{\"text\":\"Frontend application architecture\",\"link\":\"/en/frontend/architecture\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"Configuring the IDE\",\"link\":\"/en/development/ide\"},{\"text\":\"Creating and building web application\",\"link\":\"/en/development/building\"},{\"text\":\"Project structure\",\"link\":\"/en/development/project-structure\"},{\"text\":\"Architectural patterns\",\"link\":\"/en/development/architectural-patterns\"},{\"text\":\"How to use images and other resources\",\"link\":\"/en/development/assets\"},{\"text\":\"Stores - Vuex, Pinia and Composition API\",\"link\":\"/en/development/stores\"},{\"text\":\"Testing\",\"link\":\"/en/development/testing\"},{\"text\":\"Useful tips\",\"link\":\"/en/development/misc\"}]},{\"text\":\"Backend\",\"items\":[{\"text\":\"Authorization and Authentication\",\"link\":\"/en/backend/auth\"},{\"text\":\"Protocols. To REST or not to REST?\",\"link\":\"/en/backend/protocols\"},{\"text\":\"API service adapter\",\"link\":\"/en/backend/api\"},{\"text\":\"Options to set up a backend\",\"link\":\"/en/backend/backend\"},{\"text\":\"CORS\",\"link\":\"/en/backend/cors\"}]},{\"text\":\"Deploy on server\",\"items\":[{\"text\":\"CI/CD\",\"link\":\"/en/deployment/ci-cd\"},{\"text\":\"Github Actions\",\"link\":\"/en/deployment/github-actions\"},{\"text\":\"Site Hosting Options\",\"link\":\"/en/deployment/hosting\"}]},{\"text\":\"Cheat-sheets\",\"link\":\"/en/misc/cheat-sheets\"},{\"text\":\"Glossary\",\"link\":\"/en/misc/glossary\"},{\"text\":\"Contribute to this FAQ\",\"link\":\"/en/misc/contribute\"}],\"/en/vue-webapp/\":[{\"text\":\"About\",\"link\":\"/en/vue-webapp/\"},{\"text\":\"Getting started\",\"link\":\"/en/vue-webapp/getting-started\"},{\"text\":\"Objectives\",\"link\":\"/en/vue-webapp/objectives\"},{\"text\":\"Guidelines\",\"link\":\"/en/vue-webapp/guidelines \"},{\"text\":\"Contribution\",\"link\":\"/en/vue-webapp/contribution\"},{\"text\":\"Options\",\"link\":\"/en/vue-webapp/options/index\",\"items\":[{\"text\":\"App layouts\",\"collapsed\":false,\"items\":[{\"text\":\"MainLayout\",\"link\":\"/en/vue-webapp/options/layout-main\"},{\"text\":\"OneColumnLayout\",\"link\":\"/en/vue-webapp/options/layout-one-column\"}]},{\"text\":\"App components\",\"collapsed\":false,\"items\":[{\"text\":\"Header\",\"link\":\"/en/vue-webapp/options/header\"},{\"text\":\"Footer\",\"link\":\"/en/vue-webapp/options/footer\"},{\"text\":\"Navigation drawer\",\"link\":\"/en/vue-webapp/options/drawer\"},{\"text\":\"Navbar\",\"link\":\"/en/vue-webapp/options/navbar\"},{\"text\":\"BaseIcon\",\"link\":\"/en/vue-webapp/options/baseIcon\"}]},{\"text\":\"Features\",\"collapsed\":false,\"items\":[{\"text\":\"Description\",\"link\":\"/en/vue-webapp/options/description\"},{\"text\":\"Adaptability\",\"link\":\"/en/vue-webapp/options/adaptability\"},{\"text\":\"Themes\",\"link\":\"/en/vue-webapp/options/themes\"},{\"text\":\"Splash screen\",\"link\":\"/en/vue-webapp/options/splash-screen\"},{\"text\":\"Google analytics\",\"link\":\"/en/vue-webapp/options/google-analytics\"},{\"text\":\"Open graph\",\"link\":\"/en/vue-webapp/options/open-graph\"},{\"text\":\"API layer\",\"link\":\"/en/vue-webapp/options/api\"},{\"text\":\"PWA\",\"link\":\"/en/vue-webapp/options/pwa\"},{\"text\":\"Github Pages deploy\",\"link\":\"/en/vue-webapp/options/ga-gp\"},{\"text\":\"i18n\",\"link\":\"/en/vue-webapp/options/i18n\"}]}]}],\"/en/release-timeline/\":[{\"text\":\"About\",\"link\":\"/en/release-timeline/index\"},{\"text\":\"Installation\",\"collapsed\":false,\"items\":[{\"text\":\"In Vue 3 project\",\"link\":\"/en/release-timeline/vue-3\"},{\"text\":\"In VitePress\",\"link\":\"/en/release-timeline/vitepress\"},{\"text\":\"As micro-frontend\",\"link\":\"/en/release-timeline/microfrontend\"},{\"text\":\"Web component\",\"link\":\"/en/release-timeline/web-component\"}]},{\"text\":\"Configuration\",\"link\":\"/en/release-timeline/config\"},{\"text\":\"Getting data\",\"link\":\"/en/release-timeline/getting-data\"},{\"text\":\"Release Timeline\",\"link\":\"/en/release-timeline/release-history\"}]},\"socialLinks\":[{\"icon\":\"twitter\",\"link\":\"https://twitter.com/vuefaq\"},{\"icon\":\"github\",\"link\":\"https://github.com/vuesence/vue-faq\"},{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><text font-weight=\\\"bold\\\" xml:space=\\\"preserve\\\" font-size=\\\"18\\\" id=\\\"svg_1\\\" y=\\\"16\\\" x=\\\"8\\\" fill=\\\"currentColor\\\">Star it!</text></g></svg>\"},\"link\":\"https://github.com/vuesence/vue-faq\"}]},\"head\":[[\"script\",{\"async\":\"\",\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-JCCRGKJ88B\"}],[\"script\",{},\"window.dataLayer = window.dataLayer || [];\\n          function gtag(){dataLayer.push(arguments);}\\n          gtag('js', new Date());\\n          gtag('config', 'G-JCCRGKJ88B');\"]]}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>